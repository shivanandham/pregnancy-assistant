---
description: "Backend development guidelines and API structure"
alwaysApply: false
---
# Backend Development Guidelines

## API Structure
- Express.js backend with Prisma ORM
- Main endpoints: /api/chat, /api/pregnancy, /api/symptoms, /api/appointments, /api/weight, /api/home
- Security: Helmet.js, CORS, rate limiting, input validation with Joi
- AI integration: Google Gemini API with pregnancy-specific context and medical disclaimers

## Database Schema (Prisma)
- UserProfile: User demographics and medical information
- PregnancyData: Due date, LMP, and pregnancy timeline
- ChatSession/ChatMessage: AI conversation management with diagnostic support
- Symptom/Appointment/WeightEntry: Health tracking data
- KnowledgeFact/ConversationChunk: Extracted knowledge and searchable conversations
- PregnancyTip/ChecklistCompletion: Tips and daily task tracking

## Environment Configuration
- Development: http://192.168.0.8:3000 (local network)
- Production: Self-hosted PostgreSQL on DigitalOcean
- Database: Local PostgreSQL (dev) / Self-hosted PostgreSQL (prod)
- AI: Google Gemini API key required
- Authentication: Firebase Auth with Google Sign-In

## Common Commands
- Backend: `npm run dev` (development), `npm run deploy:db` (database)
- Database: `npm run db:studio` (Prisma Studio)

## AI Services Guidelines
- Always include medical disclaimers in AI responses
- Use pregnancy-specific context with current week information
- Implement diagnostic questioning for symptom assessment
- Extract and store knowledge from conversations for future reference

## Authentication & Security
- Firebase Auth with Google Sign-In for user authentication
- JWT token validation for API endpoints
- User session management with automatic token refresh
- Secure user data synchronization between Firebase and backend
- Multi-user support with user-specific data isolation

## Database Configuration
- Development: Local PostgreSQL with Prisma migrations
- Production: Self-hosted PostgreSQL on DigitalOcean
- Database URL configuration via environment variables
- Automatic database URL selection based on NODE_ENV
- Connection pooling and graceful shutdown handling